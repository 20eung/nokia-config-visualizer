services:
  nokia-visualizer:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: nokia-visualizer
    hostname: nokia-visualizer
    restart: unless-stopped
    ports:
      - "3301:80"
    environment:
      - NODE_ENV=production
      - TZ=Asia/Seoul
    depends_on:
      - nokia-api
    networks:
      - npm-network

  nokia-api:
    build:
      context: ./server
      dockerfile: Dockerfile
    container_name: nokia-api
    hostname: nokia-api
    restart: unless-stopped
    environment:
      - TZ=Asia/Seoul
      - AWS_REGION=${AWS_REGION:-ap-northeast-2}
      - AWS_DEFAULT_REGION=${AWS_DEFAULT_REGION:-ap-northeast-2}
      - AWS_PROFILE=${AWS_PROFILE:-}
      - BEDROCK_MODEL_ID=${BEDROCK_MODEL_ID:-global.anthropic.claude-sonnet-4-5-20250929-v1:0}
    volumes:
      - ${HOME}/.aws:/root/.aws:ro
      - dict-data:/app/data
      # === Auto Config Loading: Config folder mount (auto-config-loading) ===
      # 프로젝트 루트의 ./configs 폴더를 컨테이너에 마운트 (읽기 전용)
      # 사용법: 프로젝트 루트에 configs 폴더 생성 후 백업 파일 저장
      # 예: mkdir -p configs && cp ~/backups/*.txt configs/
      - ./configs:/app/configs:ro
    ports:
      - "3001:3000"  # 외부:3001 -> 컨테이너 내부:3000 (WebSocket 및 API)
    networks:
      - npm-network

volumes:
  dict-data:

networks:
  npm-network:
    driver: bridge
